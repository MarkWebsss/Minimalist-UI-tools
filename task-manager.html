<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tasks</title>
<link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Instrument+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #faf9f7;
    --paper: #fff;
    --ink: #1a1814;
    --ink2: #8a8680;
    --ink3: #c5c2be;
    --line: #eeece9;
    --accent: #c0392b;
    --done-color: #b0ada8;
    --shadow: 0 1px 3px rgba(0,0,0,0.06), 0 4px 16px rgba(0,0,0,0.04);
  }

  html.dark {
    --bg: #111110;
    --paper: #1c1c1a;
    --ink: #f0ede8;
    --ink2: #7a7672;
    --ink3: #4a4844;
    --line: #2a2926;
    --accent: #e05a4a;
    --done-color: #4a4844;
    --shadow: 0 1px 3px rgba(0,0,0,0.3), 0 4px 16px rgba(0,0,0,0.2);
  }

  html, body {
    height: 100%;
  }

  body {
    background: var(--bg);
    font-family: 'Instrument Sans', sans-serif;
    color: var(--ink);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 60px 20px 100px;
  }

  /* Header */
  header {
    width: 100%;
    max-width: 560px;
    margin-bottom: 48px;
    animation: fadeUp 0.5s ease both;
  }

  .date-str {
    font-size: 12px;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--ink2);
    margin-bottom: 8px;
  }

  h1 {
    font-family: 'Instrument Serif', serif;
    font-size: 42px;
    font-weight: 400;
    line-height: 1;
    color: var(--ink);
    letter-spacing: -0.01em;
  }

  h1 em {
    font-style: italic;
    color: var(--accent);
  }

  .stats {
    margin-top: 10px;
    font-size: 13px;
    color: var(--ink2);
  }

  /* Filter tabs */
  .filters {
    display: flex;
    gap: 4px;
    margin-bottom: 28px;
    width: 100%;
    max-width: 560px;
    animation: fadeUp 0.5s 0.05s ease both;
  }

  .filter-btn {
    background: none;
    border: none;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 13px;
    color: var(--ink2);
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 100px;
    transition: all 0.15s;
    letter-spacing: 0.02em;
  }

  .filter-btn:hover { color: var(--ink); background: var(--line); }
  .filter-btn.active {
    color: var(--ink);
    background: var(--paper);
    box-shadow: var(--shadow);
    font-weight: 500;
  }

  /* Input */
  .input-row {
    width: 100%;
    max-width: 560px;
    display: flex;
    gap: 10px;
    margin-bottom: 24px;
    animation: fadeUp 0.5s 0.1s ease both;
  }

  .task-input {
    flex: 1;
    background: var(--paper);
    border: 1.5px solid var(--line);
    border-radius: 10px;
    padding: 14px 18px;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 15px;
    color: var(--ink);
    outline: none;
    transition: border-color 0.15s, box-shadow 0.15s;
    box-shadow: var(--shadow);
  }

  .task-input::placeholder { color: var(--ink3); }

  .task-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(192,57,43,0.08), var(--shadow);
  }

  .add-btn {
    background: var(--ink);
    color: #fff;
    border: none;
    border-radius: 10px;
    width: 50px;
    height: 50px;
    font-size: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    flex-shrink: 0;
    box-shadow: var(--shadow);
    line-height: 1;
  }

  .add-btn:hover { background: var(--accent); transform: scale(1.05); }
  .add-btn:active { transform: scale(0.96); }

  /* Category selector */
  .cat-row {
    display: flex;
    gap: 6px;
    width: 100%;
    max-width: 560px;
    margin-bottom: 28px;
    animation: fadeUp 0.5s 0.12s ease both;
    flex-wrap: wrap;
  }

  .cat-chip {
    border: 1.5px solid var(--line);
    background: var(--paper);
    border-radius: 100px;
    padding: 5px 14px;
    font-size: 12px;
    font-family: 'Instrument Sans', sans-serif;
    color: var(--ink2);
    cursor: pointer;
    transition: all 0.12s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .cat-chip .dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
  }

  .cat-chip:hover { border-color: var(--ink3); color: var(--ink); }
  .cat-chip.selected {
    background: var(--ink);
    border-color: var(--ink);
    color: #fff;
  }
  .cat-chip.selected .dot { background: #fff !important; }

  /* Task list */
  .task-list {
    width: 100%;
    max-width: 560px;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  /* Section label */
  .section-label {
    font-size: 11px;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--ink3);
    margin: 20px 0 8px 4px;
    font-weight: 500;
  }

  .section-label:first-child { margin-top: 0; }

  /* Task item */
  .task-item {
    background: var(--paper);
    border-radius: 10px;
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 14px;
    border: 1.5px solid transparent;
    transition: all 0.2s ease;
    cursor: default;
    animation: slideIn 0.25s ease both;
    position: relative;
    group: true;
  }

  .task-item:hover {
    border-color: var(--line);
    box-shadow: var(--shadow);
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @keyframes strikeIn {
    from { width: 0; }
    to   { width: 100%; }
  }

  /* Checkbox */
  .check {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1.5px solid var(--ink3);
    cursor: pointer;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    position: relative;
  }

  .check:hover { border-color: var(--accent); }

  .check.done {
    background: var(--ink3);
    border-color: var(--ink3);
  }

  .check.done::after {
    content: '';
    width: 5px;
    height: 9px;
    border: 1.5px solid white;
    border-top: none;
    border-left: none;
    transform: rotate(40deg) translateY(-1px);
    display: block;
  }

  /* Task text */
  .task-body {
    flex: 1;
    min-width: 0;
  }

  .task-text {
    font-size: 15px;
    color: var(--ink);
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    position: relative;
    display: inline-block;
    max-width: 100%;
  }

  .task-text::after {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    height: 1.5px;
    background: var(--ink2);
    width: 0;
    transition: width 0.3s ease;
  }

  .task-item.done .task-text {
    color: var(--done-color);
  }

  .task-item.done .task-text::after {
    width: 100%;
  }

  .task-meta {
    font-size: 11px;
    color: var(--ink3);
    margin-top: 2px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .cat-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
  }

  .cat-badge .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  /* Task actions */
  .task-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.15s;
  }

  .task-item:hover .task-actions { opacity: 1; }

  .action-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--ink3);
    padding: 4px 6px;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.12s;
    line-height: 1;
  }

  .action-btn:hover { color: var(--accent); background: rgba(192,57,43,0.06); }

  /* Empty state */
  .empty {
    text-align: center;
    padding: 60px 20px;
    color: var(--ink3);
    animation: fadeUp 0.4s ease both;
  }

  .empty-icon {
    font-size: 36px;
    margin-bottom: 12px;
    opacity: 0.4;
  }

  .empty p {
    font-family: 'Instrument Serif', serif;
    font-style: italic;
    font-size: 18px;
    color: var(--ink2);
  }

  /* Progress bar */
  .progress-wrap {
    width: 100%;
    max-width: 560px;
    margin-bottom: 28px;
    animation: fadeUp 0.5s 0.15s ease both;
  }

  .progress-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 12px;
    color: var(--ink2);
  }

  .progress-bar {
    height: 3px;
    background: var(--line);
    border-radius: 100px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 100px;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Theme toggle */
  .theme-toggle {
    position: fixed;
    top: 24px;
    right: 24px;
    background: var(--paper);
    border: 1.5px solid var(--line);
    border-radius: 100px;
    padding: 7px 14px;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 12px;
    color: var(--ink2);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 7px;
    transition: all 0.2s ease;
    box-shadow: var(--shadow);
    letter-spacing: 0.04em;
    z-index: 100;
  }

  .theme-toggle:hover {
    color: var(--ink);
    border-color: var(--ink3);
  }

  .theme-toggle .toggle-icon {
    font-size: 14px;
    transition: transform 0.4s ease;
  }

  html.dark .theme-toggle .toggle-icon {
    transform: rotate(180deg);
  }

  /* Smooth theme transition */
  body, .task-item, .task-input, .add-btn, .filter-btn, .cat-chip, .theme-toggle {
    transition: background 0.25s ease, color 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
  }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--ink3); border-radius: 4px; }
</style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">
  <span class="toggle-icon">☀︎</span>
  <span id="theme-label">Light</span>
</button>

<header>
  <div class="date-str" id="date-str"></div>
  <h1>My <em>Tasks</em></h1>
  <div class="stats" id="stats"></div>
</header>

<div class="progress-wrap">
  <div class="progress-row">
    <span>Progress</span>
    <span id="progress-pct">0%</span>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill" style="width:0%"></div>
  </div>
</div>

<div class="filters">
  <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
  <button class="filter-btn" data-filter="active" onclick="setFilter('active')">Active</button>
  <button class="filter-btn" data-filter="done" onclick="setFilter('done')">Done</button>
</div>

<div class="input-row">
  <input class="task-input" id="task-input" placeholder="Add a task…" maxlength="120" />
  <button class="add-btn" onclick="addTask()" title="Add task">+</button>
</div>

<div class="cat-row" id="cat-row"></div>

<div class="task-list" id="task-list"></div>

<script>
  const CATEGORIES = [
    { id: 'work',     label: 'Work',     color: '#4A90D9' },
    { id: 'personal', label: 'Personal', color: '#7CB87A' },
    { id: 'urgent',   label: 'Urgent',   color: '#c0392b' },
    { id: 'idea',     label: 'Idea',     color: '#E8A838' },
  ];

  let tasks = JSON.parse(localStorage.getItem('tasks_v1') || '[]');
  let selectedCat = null;
  let currentFilter = 'all';

  // Theme
  const isDark = localStorage.getItem('theme') === 'dark';
  if (isDark) applyDark(true);

  function applyDark(dark) {
    document.documentElement.classList.toggle('dark', dark);
    document.getElementById('theme-label').textContent = dark ? 'Dark' : 'Light';
  }

  function toggleTheme() {
    const nowDark = document.documentElement.classList.contains('dark');
    applyDark(!nowDark);
    localStorage.setItem('theme', !nowDark ? 'dark' : 'light');
  }

  // Date
  const d = new Date();
  document.getElementById('date-str').textContent = d.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });

  // Build category chips
  function buildCatRow() {
    const row = document.getElementById('cat-row');
    row.innerHTML = '';
    CATEGORIES.forEach(cat => {
      const chip = document.createElement('button');
      chip.className = 'cat-chip' + (selectedCat === cat.id ? ' selected' : '');
      chip.onclick = () => { selectedCat = selectedCat === cat.id ? null : cat.id; buildCatRow(); };
      chip.innerHTML = `<span class="dot" style="background:${selectedCat === cat.id ? '#fff' : cat.color}"></span>${cat.label}`;
      row.appendChild(chip);
    });
  }

  function save() { localStorage.setItem('tasks_v1', JSON.stringify(tasks)); }

  function addTask() {
    const input = document.getElementById('task-input');
    const text = input.value.trim();
    if (!text) { input.focus(); return; }
    tasks.unshift({ id: Date.now(), text, done: false, cat: selectedCat, created: Date.now() });
    save();
    input.value = '';
    input.focus();
    render();
  }

  function toggleDone(id) {
    const t = tasks.find(t => t.id === id);
    if (t) { t.done = !t.done; save(); render(); }
  }

  function deleteTask(id) {
    const el = document.querySelector(`[data-id="${id}"]`);
    if (el) {
      el.style.transition = 'all 0.2s ease';
      el.style.opacity = '0';
      el.style.transform = 'translateX(12px)';
      setTimeout(() => { tasks = tasks.filter(t => t.id !== id); save(); render(); }, 200);
    }
  }

  function setFilter(f) {
    currentFilter = f;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === f));
    render();
  }

  function getCat(id) { return CATEGORIES.find(c => c.id === id); }

  function timeAgo(ts) {
    const diff = Date.now() - ts;
    const m = Math.floor(diff / 60000);
    if (m < 1) return 'just now';
    if (m < 60) return `${m}m ago`;
    const h = Math.floor(m / 60);
    if (h < 24) return `${h}h ago`;
    return `${Math.floor(h/24)}d ago`;
  }

  function render() {
    const list = document.getElementById('task-list');

    let filtered = tasks;
    if (currentFilter === 'active') filtered = tasks.filter(t => !t.done);
    if (currentFilter === 'done')   filtered = tasks.filter(t => t.done);

    const total = tasks.length;
    const done = tasks.filter(t => t.done).length;
    const pct = total === 0 ? 0 : Math.round((done / total) * 100);

    document.getElementById('stats').textContent = `${done} of ${total} completed`;
    document.getElementById('progress-pct').textContent = `${pct}%`;
    document.getElementById('progress-fill').style.width = pct + '%';

    if (filtered.length === 0) {
      const msgs = { all: 'Nothing here yet.', active: 'All done!', done: 'Nothing completed yet.' };
      list.innerHTML = `<div class="empty"><div class="empty-icon">${currentFilter === 'done' ? '✓' : '○'}</div><p>${msgs[currentFilter]}</p></div>`;
      return;
    }

    const active = filtered.filter(t => !t.done);
    const doneList = filtered.filter(t => t.done);

    list.innerHTML = '';

    const renderSection = (items, label) => {
      if (items.length === 0) return;
      if (label) {
        const lbl = document.createElement('div');
        lbl.className = 'section-label';
        lbl.textContent = label;
        list.appendChild(lbl);
      }
      items.forEach((t, i) => {
        const cat = getCat(t.cat);
        const el = document.createElement('div');
        el.className = 'task-item' + (t.done ? ' done' : '');
        el.setAttribute('data-id', t.id);
        el.style.animationDelay = `${i * 0.03}s`;

        el.innerHTML = `
          <div class="check ${t.done ? 'done' : ''}" onclick="toggleDone(${t.id})"></div>
          <div class="task-body">
            <div class="task-text">${escHtml(t.text)}</div>
            <div class="task-meta">
              <span>${timeAgo(t.created)}</span>
              ${cat ? `<span class="cat-badge"><span class="dot" style="background:${cat.color}"></span>${cat.label}</span>` : ''}
            </div>
          </div>
          <div class="task-actions">
            <button class="action-btn" onclick="deleteTask(${t.id})" title="Delete">✕</button>
          </div>
        `;
        list.appendChild(el);
      });
    };

    if (currentFilter === 'all') {
      renderSection(active, active.length && doneList.length ? 'To do' : null);
      renderSection(doneList, doneList.length && active.length ? 'Completed' : null);
    } else {
      renderSection(filtered, null);
    }
  }

  function escHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // Enter to add
  document.getElementById('task-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') addTask();
  });

  buildCatRow();
  render();
</script>
</body>
</html>
